<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mado QR Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/kjua@0.9.0/dist/kjua.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #020617; color: white; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-field { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; border-radius: 12px; width: 100%; outline: none; color: white; font-size: 13px; }
        .active-tab { background: #3b82f6 !important; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
        .iphone-frame { width: 260px; height: 500px; border: 8px solid #1e293b; border-radius: 35px; position: relative; overflow: hidden; background: #0f172a; margin: 0 auto; transition: 0.5s; }
        .iphone-notch { width: 100px; height: 18px; background: #1e293b; position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 10; }
        .bio-btn { display: block; width: 100%; padding: 12px; border-radius: 10px; margin-bottom: 8px; text-decoration: none; color: white; font-weight: bold; text-align: center; }
        .section-title { font-size: 12px; font-weight: 800; color: #60a5fa; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body class="p-4 lg:p-10">

    <div id="creator-ui" class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400 italic">MaDo QR Pro</h1>
            <p class="text-gray-500 text-xs mt-2 uppercase tracking-[0.3em]">Smart Customization Studio</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <div class="lg:col-span-5 space-y-6">
                
                <div class="glass p-6 rounded-[2.5rem]">
                    <div class="section-title"><span>1</span> Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="flex p-1 bg-black/40 rounded-2xl gap-1 mb-6 overflow-x-auto">
                        <button onclick="switchTab('url')" id="tab-url" class="tab-btn active-tab px-4 py-2 rounded-xl text-[10px] font-bold transition">Ø±Ø§Ø¨Ø·</button>
                        <button onclick="switchTab('vcard')" id="tab-vcard" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition">Ø§ØªØµØ§Ù„</button>
                        <button onclick="switchTab('wifi')" id="tab-wifi" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition">WiFi</button>
                        <button onclick="switchTab('bio')" id="tab-bio" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition text-yellow-400">Identity Pro</button>
                    </div>
                    <div id="dynamic-fields" class="space-y-4 min-h-[120px]"></div>
                </div>

                <div class="glass p-6 rounded-[2.5rem] border-blue-500/20">
                    <div class="section-title"><span>2</span> ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-black/20 p-3 rounded-2xl border border-white/5">
                            <label class="block text-[10px] text-gray-400 mb-2">Ù„ÙˆÙ† Ø§Ù„Ù†Ù‚Ø§Ø·</label>
                            <input type="color" id="qr-fill" value="#0f172a" class="w-full h-8 bg-transparent cursor-pointer">
                        </div>
                        <div class="bg-black/20 p-3 rounded-2xl border border-white/5">
                            <label class="block text-[10px] text-gray-400 mb-2">Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                            <input type="color" id="qr-bg" value="#ffffff" class="w-full h-8 bg-transparent cursor-pointer">
                        </div>
                    </div>
                    <div class="bg-black/20 p-3 rounded-2xl border border-white/5">
                        <label class="block text-[10px] text-gray-400 mb-2">Ù†Ù…Ø· Ø§Ù„Ø­ÙˆØ§Ù ÙˆØ§Ù„Ø£Ø´ÙƒØ§Ù„</label>
                        <select id="qr-rounded" class="input-field border-none bg-transparent">
                            <option value="0">Ø²ÙˆØ§ÙŠØ§ Ù…Ø±Ø¨Ø¹Ø© Ø­Ø§Ø¯Ø©</option>
                            <option value="25">Ø²ÙˆØ§ÙŠØ§ Ø§Ù†Ø³ÙŠØ§Ø¨ÙŠØ©</option>
                            <option value="50" selected>ØªØµÙ…ÙŠÙ… Ø¯Ø§Ø¦Ø±ÙŠ Ù…ÙˆØ¯Ø±Ù†</option>
                            <option value="100">Ù†Ù…Ø· Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù†ÙØµÙ„Ø©</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateFinalMadoQR()" class="w-full bg-blue-600 p-5 rounded-2xl font-black text-xl shadow-xl hover:bg-blue-500 hover:scale-[1.02] transition-all">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù†</button>
            </div>

            <div id="preview-section" class="lg:col-span-3 hidden opacity-0 transition-all duration-500 scale-90">
                <div class="iphone-frame" id="live-bg">
                    <div class="iphone-notch"></div>
                    <div id="preview-content" class="p-6 pt-10 text-center h-full overflow-y-auto"></div>
                </div>
            </div>

            <div id="qr-section" class="lg:col-span-4 flex flex-col items-center justify-center">
                <div id="result-wrapper" class="hidden bg-white p-6 rounded-[2.5rem] shadow-2xl scale-0 transition-all duration-500">
                    <div id="qr-target"></div>
                </div>
                <div id="qr-placeholder" class="text-gray-700 text-sm italic border-2 border-dashed border-gray-800 p-20 rounded-[2.5rem]">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                
                <div id="download-group" class="hidden flex flex-col gap-3 mt-6 w-full max-w-[220px]">
                    <button onclick="downloadQR('png')" class="bg-white text-black p-4 rounded-2xl font-bold shadow-lg hover:bg-gray-100 transition flex items-center justify-center gap-2">
                        <span>ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ PNG
                    </button>
                    <button onclick="downloadQR('svg')" class="bg-blue-500/10 border border-blue-500/50 text-blue-400 p-4 rounded-2xl font-bold shadow-lg hover:bg-blue-500/20 transition flex items-center justify-center gap-2">
                        <span>ğŸ“</span> ØªØ­Ù…ÙŠÙ„ SVG (Ù„Ù„Ù…Ø·Ø§Ø¨Ø¹)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="viewer-ui" class="hidden min-h-screen flex flex-col items-center p-10 text-center">
        <div id="v-icon" class="w-24 h-24 rounded-[30px] flex items-center justify-center text-4xl mb-6 shadow-2xl">ğŸ‘¤</div>
        <h2 id="v-name" class="text-4xl font-black"></h2>
        <div id="v-links" class="w-full max-w-sm px-4 mt-8"></div>
    </div>

    <script>
        let currentTab = 'url';
        const fields = {
            url: `<label class="text-[10px] text-gray-400 font-bold uppercase">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label><input type="text" id="m-url" placeholder="https://example.com" class="input-field">`,
            wifi: `<div class="space-y-3"><input type="text" id="w-ssid" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ© (SSID)" class="input-field"><input type="password" id="w-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="input-field"></div>`,
            vcard: `<div class="space-y-3"><input type="text" id="vc-n" oninput="live()" placeholder="Ø§Ù„Ø§Ø³Ù…" class="input-field"><input type="text" id="vc-p" oninput="live()" placeholder="Ø§Ù„Ø¬ÙˆØ§Ù„" class="input-field"><input type="text" id="vc-e" oninput="live()" placeholder="Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„" class="input-field"></div>`,
            bio: `<div class="space-y-4">
                    <div class="flex gap-2 justify-center bg-black/30 p-2 rounded-xl">
                        <input type="color" id="acc-c" oninput="live()" title="Ù„ÙˆÙ† Ø§Ù„Ù‡ÙˆÙŠØ©">
                        <input type="color" id="bg-c" oninput="live()" value="#0f172a" title="Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©">
                    </div>
                    <input type="text" id="b-n" oninput="live()" placeholder="Ø§Ù„Ø§Ø³Ù…" class="input-field">
                    <div id="l-box" class="space-y-2"><div class="flex gap-1"><input type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="ln input-field"><input type="text" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·" class="lu input-field"></div></div>
                    <button onclick="addR('l-box')" class="text-xs text-blue-400">+ Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¥Ø¶Ø§ÙÙŠ</button>
                </div>`
        };

        function switchTab(t) {
            currentTab = t;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('dynamic-fields').innerHTML = fields[t];
            
            const preview = document.getElementById('preview-section');
            if(t === 'bio' || t === 'vcard') {
                preview.classList.remove('hidden');
                setTimeout(() => { preview.classList.add('opacity-100', 'scale-100'); }, 10);
            } else {
                preview.classList.add('hidden');
            }
            live();
        }

        function addR(id) {
            const div = document.createElement('div');
            div.className = "flex gap-1 mt-1";
            div.innerHTML = `<input type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="ln input-field"><input type="text" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·" class="lu input-field">`;
            document.getElementById(id).appendChild(div);
        }

        function live() {
            const content = document.getElementById('preview-content');
            if(currentTab === 'bio') {
                const n = document.getElementById('b-n').value || "Ø§Ù„Ø§Ø³Ù…";
                const acc = document.getElementById('acc-c').value;
                document.getElementById('live-bg').style.backgroundColor = document.getElementById('bg-c').value;
                content.innerHTML = `<div class="w-14 h-14 rounded-2xl mx-auto mb-3 flex items-center justify-center text-2xl" style="background:${acc}">ğŸ‘¤</div><h4 class="text-white">${n}</h4>`;
            }
        }

        function generateFinalMadoQR() {
            let txt = "";
            const fill = document.getElementById('qr-fill').value;
            const bg = document.getElementById('qr-bg').value;
            const rounded = parseInt(document.getElementById('qr-rounded').value);

            if(currentTab === 'url') txt = document.getElementById('m-url').value;
            else if(currentTab === 'wifi') txt = `WIFI:S:${document.getElementById('w-ssid').value};P:${document.getElementById('w-pass').value};;`;
            else if(currentTab === 'vcard') {
                txt = `BEGIN:VCARD\nVERSION:3.0\nFN:${document.getElementById('vc-n').value}\nTEL:${document.getElementById('vc-p').value}\nEMAIL:${document.getElementById('vc-e').value}\nEND:VCARD`;
            }
            else if(currentTab === 'bio') {
                const d = { n:document.getElementById('b-n').value, a:document.getElementById('acc-c').value, b:document.getElementById('bg-c').value, 
                             l:Array.from(document.querySelectorAll('#l-box .flex')).map(r=>({n:r.querySelector('.ln').value, u:r.querySelector('.lu').value})).filter(x=>x.n) };
                txt = window.location.href.split('#')[0] + "#" + btoa(unescape(encodeURIComponent(JSON.stringify(d))));
            }

            if(!txt) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");

            const target = document.getElementById('qr-target');
            target.innerHTML = "";
            
            const qr = kjua({
                text: txt,
                size: 800, // Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ù„Ù„Ø¯Ù‚Ø©
                fill: fill,
                back: bg,
                rounded: rounded,
                render: 'canvas'
            });

            target.appendChild(qr);
            
            const wrapper = document.getElementById('result-wrapper');
            wrapper.classList.remove('hidden');
            setTimeout(() => wrapper.classList.add('scale-100'), 50);
            document.getElementById('download-group').classList.remove('hidden');
            document.getElementById('qr-placeholder').classList.add('hidden');
        }

        function downloadQR(format) {
            const canvas = document.querySelector('#qr-target canvas');
            if(!canvas) return;

            if(format === 'png') {
                const link = document.createElement('a');
                link.download = 'Mado_QR.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
            } else {
                const fill = document.getElementById('qr-fill').value;
                const bg = document.getElementById('qr-bg').value;
                const rounded = parseInt(document.getElementById('qr-rounded').value);
                const svgQr = kjua({ text: "MadoQR", render: 'svg', fill: fill, back: bg, rounded: rounded, size: 400 });
                const svgData = new XMLSerializer().serializeToString(svgQr);
                const svgBlob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
                const url = URL.createObjectURL(svgBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = "Mado_QR.svg";
                link.click();
            }
        }

        function checkViewer() {
            const h = window.location.hash.substring(1);
            if(h && h.length > 30) {
                try {
                    const d = JSON.parse(decodeURIComponent(escape(atob(h))));
                    document.getElementById('creator-ui').style.display='none';
                    document.getElementById('viewer-ui').classList.remove('hidden');
                    document.body.style.background = d.b;
                    document.getElementById('v-icon').style.backgroundColor = d.a;
                    document.getElementById('v-name').innerText = d.n;
                    document.getElementById('v-links').innerHTML = d.l.map(l => {
                        let u = l.u.startsWith('http') ? l.u : 'https://'+l.u;
                        return `<a href="${u}" target="_blank" class="bio-btn" style="background:${d.a}">${l.n}</a>`;
                    }).join('');
                } catch(e) {}
            }
        }
        window.onload = () => { switchTab('url'); checkViewer(); };
    </script>
</body>
</html>
