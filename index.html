
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mado QR Studio | Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/kjua@0.9.0/dist/kjua.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #020617; color: white; min-height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input-field { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; border-radius: 12px; width: 100%; outline: none; color: white; font-size: 13px; }
        .active-tab { background: #3b82f6 !important; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
        .iphone-frame { width: 260px; height: 500px; border: 8px solid #1e293b; border-radius: 35px; position: relative; overflow: hidden; background: #0f172a; margin: 0 auto; transition: 0.5s; }
        .iphone-notch { width: 100px; height: 18px; background: #1e293b; position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 10; }
        .preview-btn { width: 100%; padding: 10px; border-radius: 10px; margin-bottom: 8px; font-size: 10px; font-weight: bold; text-align: center; color: white; }
        .color-dot { width: 22px; height: 22px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; }
        
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶ */
        .bio-btn { 
            display: block; 
            width: 100%; 
            padding: 14px; 
            border-radius: 16px; 
            margin-bottom: 12px; 
            text-decoration: none; 
            color: white; 
            font-weight: 800; 
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .bio-btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
    </style>
</head>
<body class="p-4 lg:p-10">
    <div id="creator-ui" class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400 italic">MaDo QR </h1>
            <p class="text-gray-500 text-xs mt-2 uppercase tracking-[0.3em]">Smart QR System</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <div class="lg:col-span-5 glass p-6 rounded-[2.5rem] space-y-6">
                <div class="flex p-1 bg-black/40 rounded-2xl gap-1 overflow-x-auto">
                    <button onclick="switchTab('url')" id="tab-url" class="tab-btn active-tab px-4 py-2 rounded-xl text-[10px] font-bold transition">Ø±Ø§Ø¨Ø·</button>
                    <button onclick="switchTab('vcard')" id="tab-vcard" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition">Ø§ØªØµØ§Ù„</button>
                    <button onclick="switchTab('wifi')" id="tab-wifi" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition">WiFi</button>
                    <button onclick="switchTab('bio')" id="tab-bio" class="tab-btn px-4 py-2 rounded-xl text-[10px] font-bold transition text-yellow-400">Identity Pro</button>
                </div>

                <div id="dynamic-fields" class="space-y-4 min-h-[350px]"></div>
                <button onclick="generateFinalMadoQR()" class="w-full bg-blue-600 p-5 rounded-2xl font-black text-xl shadow-xl hover:bg-blue-500 transition-all">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
            </div>

            <div id="preview-section" class="lg:col-span-3 hidden opacity-0 transition-all duration-500 scale-90">
                <div class="iphone-frame" id="live-bg">
                    <div class="iphone-notch"></div>
                    <div id="preview-content" class="p-6 pt-10 text-center h-full overflow-y-auto"></div>
                </div>
            </div>

            <div id="qr-section" class="lg:col-span-4 flex flex-col items-center justify-center">
                <div id="result-wrapper" class="hidden bg-white p-6 rounded-[2.5rem] shadow-2xl">
                    <div id="qr-target"></div>
                </div>
                <div id="qr-placeholder" class="text-gray-700 text-sm italic">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                <button id="dl-btn" onclick="downloadQR()" class="hidden mt-6 bg-white text-black px-10 py-3 rounded-full font-black shadow-lg">ØªØ­Ù…ÙŠÙ„ PNG</button>
            </div>
        </div>
    </div>

    <div id="viewer-ui" class="hidden min-h-screen flex flex-col items-center p-10 text-center">
        <div id="v-icon" class="w-24 h-24 rounded-[30px] flex items-center justify-center text-4xl mb-6 shadow-2xl">ğŸ‘¤</div>
        <h2 id="v-name" class="text-4xl font-black"></h2>
        <p id="v-desc" class="text-sm opacity-80 mt-2 mb-10 max-w-sm"></p>
        <div id="v-links" class="w-full max-w-sm px-4"></div>
        <div id="v-contacts" class="flex flex-wrap justify-center gap-3 mt-10"></div>
    </div>

    <script>
        let currentTab = 'url';
        const fields = {
            url: `<label class="text-[10px] text-gray-400 font-bold uppercase">Ø§Ù„Ø±Ø§Ø¨Ø·</label><input type="text" id="m-url" placeholder="https://..." class="input-field">`,
            wifi: `<div class="space-y-3"><input type="text" id="w-ssid" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø¨ÙƒØ©" class="input-field"><input type="password" id="w-pass" placeholder="Ø§Ù„Ø±Ù…Ø²" class="input-field"></div>`,
            vcard: `<div class="space-y-3"><label class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ø±Øª</label>
                    <input type="text" id="vc-n" oninput="live()" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="input-field">
                    <input type="text" id="vc-p" oninput="live()" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="input-field">
                    <input type="text" id="vc-e" oninput="live()" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„" class="input-field">
                    <input type="text" id="vc-o" oninput="live()" placeholder="Ø§Ù„Ø´Ø±ÙƒØ© / Ø§Ù„Ù…Ù†ØµØ¨" class="input-field"></div>`,
            bio: `<div class="space-y-4">
                    <div class="flex gap-2 justify-center bg-black/30 p-2 rounded-xl">
                        <div onclick="applyT('#2563eb','#020617')" class="color-dot" style="background:#2563eb"></div>
                        <div onclick="applyT('#db2777','#110005')" class="color-dot" style="background:#db2777"></div>
                        <div onclick="applyT('#059669','#011a13')" class="color-dot" style="background:#059669"></div>
                        <input type="color" id="acc-c" oninput="live()" class="w-6 h-6 bg-transparent border-none">
                        <input type="color" id="bg-c" oninput="live()" value="#0f172a" class="w-6 h-6 bg-transparent border-none">
                    </div>
                    <input type="text" id="b-n" oninput="live()" placeholder="Ø§Ù„Ø§Ø³Ù…" class="input-field">
                    <textarea id="b-d" oninput="live()" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ" class="input-field h-16"></textarea>
                    <div id="l-box" class="space-y-2"><div class="flex gap-1"><input type="text" oninput="live()" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø·" class="ln input-field"><input type="text" placeholder="URL" class="lu input-field"></div></div>
                    <button onclick="addR('l-box')" class="text-[10px] text-blue-400">+ Ø±Ø§Ø¨Ø·</button>
                    <div id="c-box" class="space-y-2 mt-4"><div class="flex gap-1"><input type="text" oninput="live()" placeholder="ÙˆØ§ØªØ³Ø§Ø¨/Ù‡Ø§ØªÙ" class="cn input-field"><input type="text" oninput="live()" placeholder="Ø§Ù„Ø±Ù‚Ù…" class="cv input-field"></div></div>
                    <button onclick="addR('c-box')" class="text-[10px] text-emerald-400">+ Ù‡Ø§ØªÙ</button>
                  </div>`
        };

        function switchTab(t) {
            currentTab = t;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('dynamic-fields').innerHTML = fields[t];
            
            const preview = document.getElementById('preview-section');
            const qrSec = document.getElementById('qr-section');
            
            if(t === 'bio' || t === 'vcard') {
                preview.classList.remove('hidden');
                setTimeout(() => { preview.classList.add('opacity-100', 'scale-100'); }, 10);
                qrSec.className = "lg:col-span-4 flex flex-col items-center justify-center";
            } else {
                preview.classList.remove('opacity-100', 'scale-100');
                setTimeout(() => { preview.classList.add('hidden'); }, 500);
                qrSec.className = "lg:col-span-7 flex flex-col items-center justify-center";
            }
            live();
        }

        function addR(id) {
            const div = document.createElement('div');
            div.className = "flex gap-1 mt-1";
            const cl = id==='l-box'?['ln','lu']:['cn','cv'];
            div.innerHTML = `<input type="text" oninput="live()" placeholder="Ø§Ù„Ø§Ø³Ù…" class="${cl[0]} input-field"><input type="text" placeholder="Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" class="${cl[1]} input-field">`;
            document.getElementById(id).appendChild(div);
        }

        function applyT(a, b) { 
             if(document.getElementById('acc-c')) {
                document.getElementById('acc-c').value=a; 
                document.getElementById('bg-c').value=b; 
                live(); 
             }
        }

        function live() {
            const content = document.getElementById('preview-content');
            const bg = document.getElementById('live-bg');

            if(currentTab === 'vcard') {
                bg.style.backgroundColor = "#1e293b";
                const n = document.getElementById('vc-n').value || "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„";
                const p = document.getElementById('vc-p').value || "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ";
                const e = document.getElementById('vc-e').value || "Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„";
                const o = document.getElementById('vc-o').value || "Ø§Ù„Ø´Ø±ÙƒØ©";
                content.innerHTML = `
                    <div class="mt-10 bg-white/5 p-6 rounded-3xl border border-white/10">
                        <div class="w-12 h-12 bg-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center text-xl">ğŸ“‡</div>
                        <h4 class="text-white font-bold text-sm">${n}</h4>
                        <p class="text-[9px] text-blue-400 mb-4">${o}</p>
                        <div class="text-[8px] text-left space-y-2 pt-4 border-t border-white/5">
                            <p class="text-gray-400">ğŸ“ ${p}</p>
                            <p class="text-gray-400">ğŸ“§ ${e}</p>
                        </div>
                    </div>`;
            } 
            else if(currentTab === 'bio') {
                const n = document.getElementById('b-n').value || "Ø§Ù„Ø§Ø³Ù…";
                const d = document.getElementById('b-d').value || "";
                const acc = document.getElementById('acc-c').value;
                bg.style.backgroundColor = document.getElementById('bg-c').value;
                
                let links = Array.from(document.querySelectorAll('.ln')).map(i => i.value?`<div class="preview-btn" style="background:${acc}">${i.value}</div>`:'').join('');
                let contacts = Array.from(document.querySelectorAll('.cn')).map(i => i.value?`<div class="px-2 py-1 rounded-full bg-white/10 text-[7px] border border-white/5">${i.value}</div>`:'').join('');
                
                content.innerHTML = `
                    <div id="p-icon" class="w-14 h-14 rounded-2xl mx-auto mb-3 flex items-center justify-center text-2xl" style="background:${acc}">ğŸ‘¤</div>
                    <h4 class="text-sm font-black text-white">${n}</h4>
                    <p class="text-[9px] text-gray-400 mb-6 px-2">${d}</p>
                    <div class="space-y-2">${links}</div>
                    <div class="flex flex-wrap justify-center gap-2 mt-4 pt-4 border-t border-white/5">${contacts}</div>`;
            }
        }

        function generateFinalMadoQR() {
            let txt = "";
            if(currentTab === 'url') txt = document.getElementById('m-url').value;
            else if(currentTab === 'wifi') txt = `WIFI:S:${document.getElementById('w-ssid').value};P:${document.getElementById('w-pass').value};;`;
            else if(currentTab === 'vcard') {
                txt = `BEGIN:VCARD\nVERSION:3.0\nFN:${document.getElementById('vc-n').value}\nTEL:${document.getElementById('vc-p').value}\nEMAIL:${document.getElementById('vc-e').value}\nORG:${document.getElementById('vc-o').value}\nEND:VCARD`;
            } else if(currentTab === 'bio') {
                const d = { 
                    n:document.getElementById('b-n').value, 
                    d:document.getElementById('b-d').value, 
                    a:document.getElementById('acc-c').value, 
                    b:document.getElementById('bg-c').value, 
                    l:Array.from(document.querySelectorAll('#l-box .flex')).map(r=>({n:r.querySelector('.ln').value, u:r.querySelector('.lu').value})).filter(x=>x.n),
                    t:Array.from(document.querySelectorAll('#c-box .flex')).map(r=>({n:r.querySelector('.cn').value, v:r.querySelector('.cv').value})).filter(x=>x.n) 
                };
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„Ù‡Ø§Ø´
                const baseUrl = window.location.href.split('#')[0];
                txt = baseUrl + "#" + btoa(unescape(encodeURIComponent(JSON.stringify(d))));
            }
            if(!txt) return alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!");
            const target = document.getElementById('qr-target');
            target.innerHTML = "";
            const qr = kjua({ text: txt, size: 400, fill: '#0f172a', back: '#fff', rounded: 12 });
            target.appendChild(qr);
            document.getElementById('result-wrapper').classList.remove('hidden');
            document.getElementById('dl-btn').classList.remove('hidden');
            document.getElementById('qr-placeholder').classList.add('hidden');
        }

        function checkViewer() {
            const h = window.location.hash.substring(1);
            if(h && h.length > 30) {
                try {
                    const d = JSON.parse(decodeURIComponent(escape(atob(h))));
                    document.getElementById('creator-ui').style.display='none';
                    document.getElementById('viewer-ui').classList.remove('hidden');
                    document.body.style.background = d.b;
                    document.getElementById('v-icon').style.backgroundColor = d.a;
                    document.getElementById('v-name').innerText = d.n;
                    document.getElementById('v-desc').innerText = d.d;
                    
                    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                    document.getElementById('v-links').innerHTML = d.l.map(l => {
                        let finalUrl = l.u.trim();
                        if (!finalUrl.startsWith('http')) {
                            finalUrl = 'https://' + finalUrl;
                        }
                        return `<a href="${finalUrl}" target="_blank" class="bio-btn" style="background:${d.a}">${l.n}</a>`;
                    }).join('');

                    document.getElementById('v-contacts').innerHTML = d.t.map(c => {
                        let link = c.n.includes('ÙˆØ§ØªØ³') ? 'https://wa.me/'+c.v.replace(/\D/g,'') : 'tel:'+c.v;
                        return `<a href="${link}" class="px-5 py-2 rounded-full border border-white/20 bg-white/5 text-xs">${c.n}</a>`;
                    }).join('');
                } catch(e) { console.error("Error parsing data"); }
            }
        }

        window.onload = checkViewer; 
        window.onhashchange = checkViewer;

        function downloadQR() {
            const canvas = document.querySelector('#qr-target canvas');
            const link = document.createElement('a');
            link.download = 'Mado_QR.png';
            link.href = canvas.toDataURL();
            link.click();
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
        switchTab('url');
    </script>
</body>
</html>
